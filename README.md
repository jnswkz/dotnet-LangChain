# dotnet-LangChain データアシスタント

## 概要
このリポジトリは、LangChain.NET と Google Generative Language API（Gemini）を組み合わせ、PostgreSQL データベースからメタデータとサンプル行を収集し、pgvector ベースのベクトルストアに取り込むアプリケーションです。アプリのゴールは、**データベース内の情報を読みやすい形に要約・検索し、LLM から自然言語で問合せできるようにする**ことです。今後はソースコード全体も同じ仕組みで埋め込み、技術ドキュメントのように扱えるよう発展させる予定です。

## 主な構成
- `Program.cs`  
  - .env から API キーと DB 接続文字列を読み込み、Google Chat Model を初期化し、RAG パイプラインを実行します。
- `data.cs`（`partial class Program`）  
  - `SyncVectorStoreAsync` が DB スキャン、ベクトルストア作成、埋め込み生成、pgvector への upsert を統括します。
  - Postgres からテーブル構造とサンプル行を抽出するユーティリティを保持します。
- `embbeding.cs`  
  - Gemini の埋め込み API を呼び出すモジュール。単体/バッチ埋め込み、正規化など、DB 用・ソースコード用で共有したい処理をまとめています。
- `dotnet-LangChain.csproj`  
  - .NET 9 をターゲットにしたコンソール アプリケーション。

## 使い方（現在のフロー）
1. `.env` に `GOOGLE_API_KEY` と `AZURE_POSTGRES_URL` を設定します。
2. `dotnet run` を実行すると、アプリが以下を自動実行します。  
   - DB からテーブル一覧・カラム情報・サンプル行を抽出し `Doc` に整形。  
   - Google の埋め込み API で文脈をベクトル化して `kb_docs` テーブルへ upsert。  
   - 例題クエリを RAG で投げ、Gemini から回答を取得。
3. 実際のユースケースでは、CLI で任意の質問（日本語/英語）を入力し、データベースに存在する知識を元に自然言語で回答を返します。

## ソースコード連携（今後の拡張）
- `embbeding.cs` を使ってソースコードの分割・埋め込み・ベクトル格納を共通化し、レポジトリ内ファイルをまたいだ検索や「コードベース Q&A」を提供する予定です。
- ソースファイルのチャンク生成・メタデータ付与・差分アップサート用に、`SyncSourceCodeAsync` のような関数を追加する計画です。
- 将来的には DB + ソースコードのハイブリッド検索を行い、アプリ利用者が「仕様の確認」「実装場所の特定」「データとコードの突合せ」を一つの会話で完結できる体験を目指します。

## 期待されるユースケース
- データベースの構造やテーブル間関係を素早く把握したいとき。
- サンプル行を見ながら、ダッシュボード作成や分析に必要な列を確認したいとき。
- （今後）リポジトリのコード全体を自然言語で検索し、具体的な実装例や参照元を知りたいとき。

## 今後のロードマップ
1. ソースコード埋め込みモジュールの実装と CLI からの問い合わせ統合。  
2. RAG プロンプトを多言語（英語/日本語/ベトナム語）に対応させる追加ガイド。  
3. CLI 以外のフロントエンド（例: Web UI）を通じたインタラクティブな会話環境。  
4. ベクトルストアの更新差分検知やジョブ化による運用最適化。
